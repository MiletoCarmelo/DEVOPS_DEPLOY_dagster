dagster:
  module: dagster
  environment: dev
  replicas: 1
  
  image:
    repository: ghcr.io/miletocarmelo/devops_helm_generic_dagster_backend/dagster
    tag: latest
  
  ports:
    containerPort: 3000
  
  service:
    type: ClusterIP
    port: 3000
    targetPort: 3000
  
  postgresql:
    enabled: false
    external:
      host: "postgres-58b495dd4d7bdm7"
      port: 5432
      database: "dagster"
      user:
        valueFrom:
          secretKeyRef:
            name: postgres-auth
            key: username
      password:
        valueFrom:
          secretKeyRef:
            name: postgres-auth
            key: password
  
  volumes:
    - name: {{ .Release.Name }}-app
      configMap:
        name: dagster-app-code
    - name: {{ .Release.Name }}-storage
      persistentVolumeClaim:
        claimName: dagster-storage
    - name: dagster-config
      configMap:
        name: {{ .Release.Name }}-config  # MÃªme nom que dans le ConfigMap
  
  volumeMounts:
    - name: {{ .Release.Name }}-app
      mountPath: /opt/dagster/app
    - name: {{ .Release.Name }}-storage
      mountPath: /opt/dagster/dagster_home/storage
    - name: {{ .Release.Name }}-config     # Ajout pour le dagster.yaml
      mountPath: /opt/dagster/dagster_home/dagster.yaml
      subPath: dagster.yaml
  
  env:
    - name: DAGSTER_HOME
      value: /opt/dagster/dagster_home